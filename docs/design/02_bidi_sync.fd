# â”€â”€â”€ Themes â”€â”€â”€

theme box_green {
  fill: #10B981  # teal
  corner: 16
}

theme box_orange {
  fill: #F59E0B  # orange
  corner: 16
}

theme box_primary {
  fill: #6C5CE7  # blue
  corner: 16
}

theme desc {
  fill: #6B7280  # blue
  font: "Inter" regular 12
}

theme label {
  fill: #1A1A2E  # blue
  font: "Inter" semibold 14
}

# â”€â”€â”€ Layout â”€â”€â”€

rect @_anon_30 {
  w: 100 h: 80
  fill: #CCCCD9  # white
  x: 694.77
  y: 460.38
}

group @perf_badges {
  spec "Non-functional requirements for sync latency"
  rect @badge_roundtrip {
    text @_anon_29 "Round-trip: <16ms" {
      fill: #D97706  # orange
      font: "Inter" semibold 13
      x: 694.32
      y: 234.5
    }
    w: 200 h: 48
    fill: #FEF3C7  # yellow
    corner: 24
    x: 623.94
    y: 719.44
  }
  rect @badge_render {
    text @_anon_28 "Render: <16ms" {
      fill: #059669  # teal
      font: "Inter" semibold 13
    }
    w: 160 h: 48
    fill: #D1FAE5  # green
    corner: 24
  }
  rect @badge_parse {
    text @_anon_27 "Parse: <16ms" {
      fill: #6C5CE7  # blue
      font: "Inter" semibold 13
    }
    w: 160 h: 48
    fill: #F0EDFC  # blue
    corner: 24
  }
  x: 548.03
  y: 445.69
}

rect @canvas {
  spec {
    "Canvas â€” GPU-rendered interactive view"
    accept: "R5.1: Vello + wgpu, 60 FPS"
    status: done
  }
  group @_anon_23 {
    text @_anon_26 "Visual drag/draw tools" {
      fill: #FEF3C7  # yellow
      font: "Inter" regular 13
    }
    text @_anon_25 "Vello + wgpu GPU render" {
      fill: #FEF3C7  # yellow
      font: "Inter" regular 13
    }
    text @_anon_24 "ðŸŽ¨ Canvas" {
      fill: #FFFFFF  # white
      font: "Inter" bold 18
    }
  }
  w: 260 h: 140
  use: box_orange
  fill: #F59E0B  # orange
  corner: 16
  x: 533.3
  y: 300.9
  when :hover {
    scale: 1.04
    ease: spring 300ms
  }
}

rect @scene_graph {
  spec {
    "SceneGraph â€” single source of truth (DAG)"
    accept: "R2.4: conflict-free single authoritative graph"
    status: done
    priority: high
  }
  group @_anon_19 {
    text @_anon_22 "Single source of truth" {
      fill: #D1FAE5  # green
      font: "Inter" regular 13
    }
    text @_anon_21 "DAG (petgraph)" {
      fill: #D1FAE5  # green
      font: "Inter" regular 13
    }
    text @_anon_20 "ðŸŒ SceneGraph" {
      fill: #FFFFFF  # white
      font: "Inter" bold 18
    }
  }
  w: 260 h: 140
  use: box_green
  fill: #10B981  # teal
  corner: 16
  x: 71.55
  y: 287.87
  when :hover {
    scale: 1.04
    ease: spring 300ms
  }
}

rect @fd_text {
  spec {
    "FD Text â€” the .fd source file"
    accept: "line-oriented, git-friendly diffs"
    status: done
    tag: core
  }
  group @_anon_15 {
    text @_anon_18 "Parser â†’ SceneGraph" {
      fill: #E0DDFF  # blue
      font: "Inter" regular 13
    }
    text @_anon_17 "Human + AI editable" {
      fill: #E0DDFF  # blue
      font: "Inter" regular 13
    }
    text @_anon_16 "ðŸ“ .fd Text" {
      fill: #FFFFFF  # white
      font: "Inter" bold 18
    }
    x: 302.76
    y: -89.96
  }
  w: 260 h: 140
  use: box_primary
  fill: #6C5CE7  # blue
  corner: 16
  x: 186.03
  y: 505.11
  when :hover {
    scale: 1.04
    ease: spring 300ms
  }
}

text @subtitle "R2: Text â†” SceneGraph â†” Canvas â€” all edits funnel through one graph" {
  fill: #6B7280  # blue
  font: "Inter" regular 16
}

text @title "Bidirectional Sync Architecture" {
  fill: #1A1A2E  # blue
  font: "Inter" extrabold 32
  x: 423.87
  y: 649.43
}

text @_text_to_graph_label "parse()" {
}

text @_graph_to_text_label "emit()" {
}

text @_graph_to_canvas_label "layout() + paint()" {
}

text @_canvas_to_graph_label "tool events" {
}

# â”€â”€â”€ Constraints â”€â”€â”€

@perf_badges -> offset: @fd_text 160, 220
@canvas -> offset: @scene_graph 320, 0
@scene_graph -> offset: @fd_text 320, 0
@fd_text -> offset: @subtitle 0, 80
@subtitle -> offset: @title 0, 50
@title -> center_in: canvas

# â”€â”€â”€ Flows â”€â”€â”€

edge @text_to_graph {
  spec {
    "R2.2: Text â†’ Canvas: source edits re-render in <16ms"
    accept: "incremental re-parse, not full document"
  }
  text @_text_to_graph_label "parse()" {}
  from: @fd_text
  to: @scene_graph
  stroke: #6C5CE7 2
  arrow: end
  curve: smooth
}
edge @graph_to_text {
  spec "R2.1: Canvas â†’ Text: visual edits update source in <16ms"
  text @_graph_to_text_label "emit()" {}
  from: @scene_graph
  to: @fd_text
  stroke: #8B5CF6 2
  arrow: end
  curve: smooth
}
edge @graph_to_canvas {
  spec "Layout solver resolves constraints â†’ absolute coords"
  text @_graph_to_canvas_label "layout() + paint()" {}
  from: @scene_graph
  to: @canvas
  stroke: #10B981 2
  arrow: end
  curve: smooth
}
edge @canvas_to_graph {
  spec "User interactions (drag, resize) mutate graph directly"
  text @_canvas_to_graph_label "tool events" {}
  from: @canvas
  to: @scene_graph
  stroke: #F59E0B 2
  arrow: end
  curve: smooth
}
