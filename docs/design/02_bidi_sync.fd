# FD v1

style box_green {
  fill: #10B981
  corner: 16
}

style box_orange {
  fill: #F59E0B
  corner: 16
}

style box_primary {
  fill: #6C5CE7
  corner: 16
}

style desc {
  fill: #6B7280
  font: "Inter" 400 12
}

style label {
  fill: #1A1A2E
  font: "Inter" 600 14
}

rect @_anon_30 {
  w: 100 h: 80
  fill: #CCCCD9
}

group @perf_badges {
  ## "Non-functional requirements for sync latency"
  layout: row gap=16 pad=0
  rect @badge_roundtrip {
    w: 200 h: 48
    fill: #FEF3C7
    corner: 24
    text @_anon_29 "Round-trip: <16ms" {
      fill: #D97706
      font: "Inter" 600 13
    }
  }
  rect @badge_render {
    w: 160 h: 48
    fill: #D1FAE5
    corner: 24
    text @_anon_28 "Render: <16ms" {
      fill: #059669
      font: "Inter" 600 13
    }
  }
  rect @badge_parse {
    w: 160 h: 48
    fill: #F0EDFC
    corner: 24
    text @_anon_27 "Parse: <16ms" {
      fill: #6C5CE7
      font: "Inter" 600 13
    }
  }
}

rect @canvas {
  ## "Canvas â€” GPU-rendered interactive view"
  ## accept: "R5.1: Vello + wgpu, 60 FPS"
  ## status: done
  w: 260 h: 140
  use: box_orange
  fill: #F59E0B
  corner: 16
  group @_anon_23 {
    layout: column gap=8 pad=24
    text @_anon_26 "Visual drag/draw tools" {
      fill: #FEF3C7
      font: "Inter" 400 13
    }
    text @_anon_25 "Vello + wgpu GPU render" {
      fill: #FEF3C7
      font: "Inter" 400 13
    }
    text @_anon_24 "ðŸŽ¨ Canvas" {
      fill: #FFFFFF
      font: "Inter" 700 18
    }
  }
  anim :hover {
    scale: 1.04
    ease: spring 300ms
  }
}

rect @scene_graph {
  ## "SceneGraph â€” single source of truth (DAG)"
  ## accept: "R2.4: conflict-free single authoritative graph"
  ## status: done
  ## priority: high
  w: 260 h: 140
  use: box_green
  fill: #10B981
  corner: 16
  group @_anon_19 {
    layout: column gap=8 pad=24
    text @_anon_22 "Single source of truth" {
      fill: #D1FAE5
      font: "Inter" 400 13
    }
    text @_anon_21 "DAG (petgraph)" {
      fill: #D1FAE5
      font: "Inter" 400 13
    }
    text @_anon_20 "ðŸŒ SceneGraph" {
      fill: #FFFFFF
      font: "Inter" 700 18
    }
  }
  anim :hover {
    scale: 1.04
    ease: spring 300ms
  }
}

rect @fd_text {
  ## "FD Text â€” the .fd source file"
  ## accept: "line-oriented, git-friendly diffs"
  ## status: done
  ## tag: core
  w: 260 h: 140
  use: box_primary
  fill: #6C5CE7
  corner: 16
  group @_anon_15 {
    layout: column gap=8 pad=24
    text @_anon_18 "Parser â†’ SceneGraph" {
      fill: #E0DDFF
      font: "Inter" 400 13
    }
    text @_anon_17 "Human + AI editable" {
      fill: #E0DDFF
      font: "Inter" 400 13
    }
    text @_anon_16 "ðŸ“ .fd Text" {
      fill: #FFFFFF
      font: "Inter" 700 18
    }
  }
  anim :hover {
    scale: 1.04
    ease: spring 300ms
  }
}

text @subtitle "R2: Text â†” SceneGraph â†” Canvas â€” all edits funnel through one graph" {
  fill: #6B7280
  font: "Inter" 400 16
}

text @title "Bidirectional Sync Architecture" {
  fill: #1A1A2E
  font: "Inter" 800 32
}

@title -> center_in: canvas
@title -> absolute: 423.87, 649.43
@subtitle -> offset: @title 0, 50
@fd_text -> offset: @subtitle 0, 80
@fd_text -> absolute: 186.03, 505.11
@_anon_15 -> absolute: 302.76, -89.96
@scene_graph -> offset: @fd_text 320, 0
@scene_graph -> absolute: 71.55, 287.87
@canvas -> offset: @scene_graph 320, 0
@canvas -> absolute: 533.3, 300.9
@perf_badges -> offset: @fd_text 160, 220
@perf_badges -> absolute: 548.03, 445.69
@badge_roundtrip -> absolute: 623.94, 719.44
@_anon_29 -> absolute: 694.32, 234.5
@_anon_30 -> absolute: 694.77, 460.38
edge @text_to_graph {
  ## "R2.2: Text â†’ Canvas: source edits re-render in <16ms"
  ## accept: "incremental re-parse, not full document"
  from: @fd_text
  to: @scene_graph
  label: "parse()"
  stroke: #6C5CE7 2
  arrow: end
  curve: smooth
}
edge @graph_to_text {
  ## "R2.1: Canvas â†’ Text: visual edits update source in <16ms"
  from: @scene_graph
  to: @fd_text
  label: "emit()"
  stroke: #8B5CF6 2
  arrow: end
  curve: smooth
}
edge @graph_to_canvas {
  ## "Layout solver resolves constraints â†’ absolute coords"
  from: @scene_graph
  to: @canvas
  label: "layout() + paint()"
  stroke: #10B981 2
  arrow: end
  curve: smooth
}
edge @canvas_to_graph {
  ## "User interactions (drag, resize) mutate graph directly"
  from: @canvas
  to: @scene_graph
  label: "tool events"
  stroke: #F59E0B 2
  arrow: end
  curve: smooth
}
